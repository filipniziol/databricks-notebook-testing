resources:
  jobs:
    player_clustering:
      name: "player_clustering"
      description: "Update features, train model, and score players"
      tags:
        project: poker_analyzer
        layer: ml

      tasks:
        # Step 1: Update Feature Table
        - task_key: update_features
          description: "Update player_features Feature Table from gold.player_statistics"
          notebook_task:
            notebook_path: ../src/notebooks/ml/update_player_features.py
          job_cluster_key: ml_cluster

        # Step 2: Train Model (depends on features)
        - task_key: train_model
          description: "Train K-Means clustering model"
          depends_on:
            - task_key: update_features
          notebook_task:
            notebook_path: ../src/notebooks/ml/train_player_clustering.py
          job_cluster_key: ml_cluster

        # Step 3: Score Players (depends on model)
        - task_key: score_players
          description: "Assign cluster labels to all players"
          depends_on:
            - task_key: train_model
          notebook_task:
            notebook_path: ../src/notebooks/ml/score_player_clusters.py
          job_cluster_key: ml_cluster

      job_clusters:
        - job_cluster_key: ml_cluster
          new_cluster:
            spark_version: "15.4.x-cpu-ml-scala2.12"
            node_type_id: "Standard_DS3_v2"
            num_workers: 0
            spark_conf:
              "spark.databricks.cluster.profile": "singleNode"
              "spark.master": "local[*, 4]"
            custom_tags:
              "ResourceClass": "SingleNode"
